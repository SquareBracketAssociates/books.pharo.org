<!DOCTYPE html>
<html>
  <head>
    <title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="images/favicon.png" type="image/x-icon" />
<link href="/booklet-Voyage/html/_support/html/css/font-awesome.min.css" rel="stylesheet">
<link href="/booklet-Voyage/html/_support/html/css/nucleus.css" rel="stylesheet">
<link href="/booklet-Voyage/html/_support/html/css/flex.css" rel="stylesheet">
<link rel="stylesheet" href="/booklet-Voyage/html/_support/html/highlightjs/styles/default.css">
<link rel="stylesheet" href="/booklet-Voyage/html/_support/html/css/highlight-commands.css">
<link rel="stylesheet" href="/booklet-Voyage/html/_support/html/css/bootstrap.min.css">
<script src="/booklet-Voyage/html/_support/html/js/jquery-2.x.min.js"></script>
<script src="/booklet-Voyage/html/_support/html/highlightjs/highlight.pack.js"></script>
<script src="/booklet-Voyage/html/_support/html/js/highlight-commands.js"></script>
<meta name="description" content="">
<meta name="author" content="Esteban Lorenzano, Stéphane Ducasse, Johan Fabry and Norbert Hartl">
  </head>
  <body>
    <header>
  <div class="logo">
    <a class="baselink" href="/booklet-Voyage/html"></a>
  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
  
</header>
<article>
  <aside>
    <ul class="menu">
   		<li data-nav-id="123" class="dd-item">
    		<a href="/booklet-Voyage/html">
		       <i class="fa fa-fw fa-home"></i>
	    	</a>
        </li>

		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/booklet-Voyage/html/Chapters/Voyage/VoyageIntro.html#voyage">
					Voyage
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/VoyageIntro.html#what is voyage?">
							What is Voyage?
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/VoyageIntro.html#voyage vision ">
							Voyage vision 
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/VoyageIntro.html#contents ">
							Contents 
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/VoyageIntro.html#load voyage">
							Load Voyage
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item  haschildren ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/VoyageIntro.html#install your document databases">
							Install your document databases
						</a>
						<i class="fa fa-angle-right fa-lg category-icon"></i>
					</div>

					<ul class="dd-item">
							
						<li class="dd-item">
							<a href="/booklet-Voyage/html/Chapters/Voyage/VoyageIntro.html#mongodb">MongoDB</a>
						</li>
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#a simple tutorial with super heroes">
					A Simple Tutorial with Super Heroes
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#creating a connection">
							Creating a connection
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#superheroes">
							SuperHeroes
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#heroes ">
							Heroes 
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#... and powers">
							... and Powers
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#root classes">
							Root classes
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#checking in mongodb">
							Checking in MongoDB
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#queries">
							Queries
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item  haschildren ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#other basic operations">
							Other Basic Operations
						</a>
						<i class="fa fa-angle-right fa-lg category-icon"></i>
					</div>

					<ul class="dd-item">
							
						<li class="dd-item">
							<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#counting">Counting</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#removing">Removing</a>
						</li>
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item  haschildren ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#adding a new root">
							Adding a new root
						</a>
						<i class="fa fa-angle-right fa-lg category-icon"></i>
					</div>

					<ul class="dd-item">
							
						<li class="dd-item">
							<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#when to add a new root">When to add a new root</a>
						</li>
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#power as a root">
							Power as a root
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#about relations">
							About relations
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#extending the hero class">
							Extending the Hero class
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#equipment can also have powers">
							Equipment can also have powers
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageTutorial/VoyageTutorial.html#conclusion">
							Conclusion
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#persisting objects with voyage">
					Persisting Objects with Voyage
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#create a repository">
							Create a repository
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#singleton mode and instance mode">
							Singleton mode and instance mode
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#voyage api">
							Voyage API
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#resetting or dropping the database connection">
							Resetting or dropping the database connection
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#testing and singleton">
							Testing and Singleton
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#storing objects">
							Storing objects
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#basic storage">
							Basic storage
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#embedding objects">
							Embedding objects
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#referencing other roots">
							Referencing other roots
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#breaking cycles in graphs">
							Breaking cycles in graphs
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#storing instances of date in mongo">
							Storing instances of Date in Mongo
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item  haschildren ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#enhancing storage">
							Enhancing storage
						</a>
						<i class="fa fa-angle-right fa-lg category-icon"></i>
					</div>

					<ul class="dd-item">
							
						<li class="dd-item">
							<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#configuring storage">Configuring storage</a>
						</li>
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#custom loading and saving of attributes">
							Custom loading and saving of attributes
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#a few words concerning the oid">
							A few words concerning the OID
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#querying in voyage">
							Querying in Voyage
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#basic object retrieval using blocks or mongoqueries">
							Basic object retrieval using blocks or mongoQueries
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#quering with elements from another root document">
							Quering with elements from another root document
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#using the at: message to access embedded documents">
							Using the at: message to access embedded documents
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#using the where: message to perform javascript comparisons">
							Using the where: message to perform Javascript comparisons
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item  haschildren ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#using json queries">
							Using JSON queries
						</a>
						<i class="fa fa-angle-right fa-lg category-icon"></i>
					</div>

					<ul class="dd-item">
							
						<li class="dd-item">
							<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#querying for an object by oid">Querying for an object by OID</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#using dot notation to access embedded documents">Using dot notation to access embedded documents</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#expressing or conditions in the query">Expressing OR conditions in the query</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#going beyond mongoqueries features">Going beyond MongoQueries features</a>
						</li>
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#executing a query">
							Executing a Query
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#basic object retrieval">
							Basic Object Retrieval
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#limiting object retrieval and sorting">
							Limiting Object Retrieval and Sorting
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#a simple paginator example">
							A Simple Paginator Example
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#creating and removing indexes">
							Creating and Removing Indexes
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#creating indexes by using osprocess">
							Creating Indexes by using OSProcess
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#verifying the use of an index">
							Verifying the use of an Index
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/Voyage/Voyage.html#conclusion">
							Conclusion
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/booklet-Voyage/html/Chapters/VoyageExtras/VoyageExtras.html#tips and tricks">
					Tips and Tricks
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageExtras/VoyageExtras.html#how to query for an object by id?    ">
							How to query for an object by id?    
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item  haschildren ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageExtras/VoyageExtras.html#not yet supported mongo commands">
							Not yet supported mongo commands
						</a>
						<i class="fa fa-angle-right fa-lg category-icon"></i>
					</div>

					<ul class="dd-item">
							
						<li class="dd-item">
							<a href="/booklet-Voyage/html/Chapters/VoyageExtras/VoyageExtras.html#indexes">Indexes</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Voyage/html/Chapters/VoyageExtras/VoyageExtras.html#backup">Backup</a>
						</li>
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageExtras/VoyageExtras.html#useful mongo commands">
							Useful mongo commands
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageExtras/VoyageExtras.html#storing instances of date in mongo">
							Storing instances of Date in Mongo
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageExtras/VoyageExtras.html#database design">
							Database design
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Voyage/html/Chapters/VoyageExtras/VoyageExtras.html#retrieving data ">
							Retrieving data 
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
    </ul>
  </aside>

  <section class="page">
    
	<h1>Voyage: Persisting Objects in Document Databases</h1>
		
	<h2>Tips and Tricks</h2>

<p>
This chapter contains some tips and tricks that people collected over the years. It was written by Sabina Manaa.
</p>

<h3>How to query for an object by id?    </h3>

<p>
If you know the _id value, you initialize an OID with this and query for it.
</p><figure><pre><code>Person selectOne: {('_id' -&gt; (OID value: 16r55CDD2B6E9A87A520F000001))} asDictionary.</code></pre><figcaption></figcaption></figure>

<p>
Note that both are equivalent:
</p><figure><pre><code>OID value: 26555050698940995562836590593. &quot;dec&quot;
OID value: 16r55CDD2B6E9A87A520F000001. &quot;hex&quot;</code></pre><figcaption></figcaption></figure>

<p>
Or you have an instance (in this example of <code>Person</code>) which is in a root collection, then you ask it for its voyageId and use it in your query. The following assumes that you have a <code>Trips</code> root collection and a <code>Persons</code> root collection. The trip has an embedded <code>receipts</code> collection. Receipts have a <code>description</code>.  The query asks for all trips of the given person with at least one receipt with the description <code>aString</code>.
</p>
<figure><pre><code> Trip
		selectMany:
			{('receipts.description' -&gt; aString).
			('person._id' -&gt; aPerson voyageId)} asDictionary</code></pre><figcaption></figcaption></figure>

<h3>Not yet supported mongo commands</h3>

<h4>Indexes</h4>
<p>
It is not yet possible to create and remove indexes from voyage, but you can use OSProcess.
</p>
<p>
Assume you have a database named <code>myDB</code> with a collection named <code>Trips</code>. 
The trips have an embedded collection with receipts. The receipts have an attribute named <code>description</code>.
Then you can create an index on description with
</p>
<figure><pre><code>OSProcess command:
'/{pathToMongoDB}/MongoDB/bin/mongo --eval &quot;db.getSiblingDB(''myDB'').Trips.createIndex({''receipts.description'':1})&quot;'</code></pre><figcaption></figcaption></figure>


<p>
Remove all indexes on the Trips collection with:
</p><figure><pre><code>OSProcess command:
'/{pathToMongoDB}/MongoDB/bin/mongo --eval &quot;db.getSiblingDB(''myDB'').Trips.dropIndexes()&quot;'</code></pre><figcaption></figcaption></figure>

<h4>Backup</h4>
<p>
It is not yet possible to create backup from voyage, so use 
</p>
<figure><pre><code>OSProcess command:
 '/{pathToMongoDB}/MongoDB/bin/mongodump  --out {BackupPath}'</code></pre><figcaption></figcaption></figure>

<p>
Please see the mongo documentation for mongo commands, especially the <code>--eval</code> command.
</p>
<h3>Useful mongo commands</h3>

<p>
Use “.explain()” in the mongo console to ensure that your query indeed uses the index.
</p>
<p>
Example:
</p>
<p>
Create an index on an embedded attribute (<code>description</code>):
</p><figure><pre><code>&gt; db.Trips.createIndex({&quot;receipts.description&quot;:1})</code></pre><figcaption></figcaption></figure>

<p>
Query for it and call explain. We see, that only 2 documents were scanned.
&gt; db.Trips.find({&quot;receipts.description&quot;:&quot;a&quot;}).explain(&quot;executionStats&quot;)
{
	&quot;cursor&quot; : &quot;BtreeCursor receipts.receiptDescription_1&quot;,
	&quot;isMultiKey&quot; : true,
	&quot;n&quot; : 2,
	&quot;nscannedObjects&quot; : 2,
	&quot;nscanned&quot; : 2,
	&quot;nscannedObjectsAllPlans&quot; : 2,
	&quot;nscannedAllPlans&quot; : 2,
	&quot;scanAndOrder&quot; : false,
	&quot;indexOnly&quot; : false,
	&quot;nYields&quot; : 0,
	&quot;nChunkSkips&quot; : 0,
	&quot;millis&quot; : 0,
	&quot;indexBounds&quot; : {
		&quot;receipts.receiptDescription&quot; : [
			[
				&quot;a&quot;,
				&quot;a&quot;
			]
		]
	},
	&quot;allPlans&quot; : [
		{
			&quot;cursor&quot; : &quot;BtreeCursor receipts.receiptDescription_1&quot;,
			&quot;n&quot; : 2,
			&quot;nscannedObjects&quot; : 2,
			&quot;nscanned&quot; : 2,
			&quot;indexBounds&quot; : {
				&quot;receipts.receiptDescription&quot; : [
					[
						&quot;a&quot;,
						&quot;a&quot;
					]
				]
			}
		}
	],
	&quot;server&quot; : &quot;MacBook-Pro-Sabine.local:27017&quot;
}
]]]
</p>
<p>
Now, remove the index
</p><figure><pre><code>&gt; db.Trips.dropIndexes()
{
	&quot;nIndexesWas&quot; : 2,
	&quot;msg&quot; : &quot;non-_id indexes dropped for collection&quot;,
	&quot;ok&quot; : 1
}</code></pre><figcaption></figcaption></figure>

<p>
Query again, all documents were scanned.
</p>
<figure><pre><code>&gt; db.Trips.find({&quot;receipts.receiptDescription&quot;:&quot;a&quot;}).explain(&quot;executionStats&quot;)
{
	&quot;cursor&quot; : &quot;BasicCursor&quot;,
	&quot;isMultiKey&quot; : false,
	&quot;n&quot; : 2,
	&quot;nscannedObjects&quot; : 246,
	&quot;nscanned&quot; : 246,
	&quot;nscannedObjectsAllPlans&quot; : 246,
	&quot;nscannedAllPlans&quot; : 246,
	&quot;scanAndOrder&quot; : false,
	&quot;indexOnly&quot; : false,
	&quot;nYields&quot; : 0,
	&quot;nChunkSkips&quot; : 0,
	&quot;millis&quot; : 1,
	&quot;indexBounds&quot; : {
		
	},
	&quot;allPlans&quot; : [
		{
			&quot;cursor&quot; : &quot;BasicCursor&quot;,
			&quot;n&quot; : 2,
			&quot;nscannedObjects&quot; : 246,
			&quot;nscanned&quot; : 246,
			&quot;indexBounds&quot; : {
				
			}
		}
	],
	&quot;server&quot; : &quot;MacBook-Pro-Sabine.local:27017&quot;
}</code></pre><figcaption></figcaption></figure>



<h3>Storing instances of Date in Mongo</h3>
<p>
A known issue of mongo is Mongo that it does not difference between <code>Date</code> and <code>DateAndTime</code>, so even if you commit a <code>Date</code>, you will get back a <code>DateAndTime</code>. You have to transform it back to <code>Date</code> manually when materializing the object.
</p>
<h3>Database design</h3>
<p>
Often you objects do not form a simple tree but a graph with cycles. For example you could have persons which are pointing to their trips and each trip knows about its person (<code>Person &lt;-&gt;&gt;Trip</code>). If you create a root Collection with Persons and a Root collection with Trips, you avoid endless loops to be generated (see chapter 1.2).
</p>
<p>
This is an example for a <code>trip</code> pointing to a <code>person</code> which is in another root collection and another root collection, <code>paymentMethod</code>. Note that the receipt also points back to the trip, which does not create a loop.
</p>
<figure><pre><code>Trip
{
 &quot;_id&quot; : ObjectId(&quot;55cf2bc73c9b0fe702000008&quot;), 
&quot;#version&quot; : 876079653, 
&quot;person&quot; : { 
	&quot;#collection&quot; : &quot;Persons&quot;, 
	&quot;_id&quot; : ObjectId(&quot;55cf2bbb3c9b0fe702000007&quot;) }, 
&quot;receipts&quot; : [ 	
	{ &quot;currency&quot; : &quot;EUR&quot;, 	
	&quot;date&quot; : { &quot;#instanceOf&quot; : &quot;ZTimestamp&quot;, &quot;jdn&quot; : 2457249, &quot;secs&quot; : 0 }, 	
	&quot;exchangeRate&quot; : 1, 	
	&quot;paymentMethod&quot; : {
		&quot;#collection&quot; : &quot;PaymentMethods&quot;, 	
		&quot;_id&quot; : ObjectId(&quot;55cf2bbb3c9b0fe702000003&quot;) }, 
	&quot;receiptDescription&quot; : &quot;Taxi zum Hotel&quot;, 	
	&quot;receiptNumber&quot; : 1, 	
	&quot;trip&quot; : { 
		&quot;#collection&quot; : &quot;Trips&quot;, 	
		&quot;_id&quot; : ObjectId(&quot;55cf2bc73c9b0fe702000008&quot;) } } ], 
	&quot;startPlace&quot; : &quot;Österreich&quot;,    
	&quot;tripName&quot; : &quot;asdf&quot;, 
	&quot;tripNumber&quot; : 1 }</code></pre><figcaption></figcaption></figure>

<p>
The corresponding <code>person</code> points to all its <code>trips</code> and to its <code>company</code>.
</p><figure><pre><code>{ &quot;#version&quot; : 714221829, 
&quot;_id&quot; : ObjectId(&quot;55cf2bbb3c9b0fe702000007&quot;), 
&quot;bankName&quot; : &quot;&quot;,
 &quot;company&quot; : { 
&quot;#collection&quot; : &quot;Companies&quot;, 
&quot;_id&quot; : ObjectId(&quot;55cf2bbb3c9b0fe702000002&quot;) },
&quot;email&quot; : &quot;bb@spesenfuchs.de&quot;, 
&quot;firstName&quot; : &quot;Berta&quot;,
&quot;lastName&quot; : &quot;Block&quot;,  
&quot;roles&quot; : [  &quot;user&quot; ], 
&quot;tableOfAccounts&quot; : &quot;SKR03&quot;, 
&quot;translator&quot; : &quot;German&quot;, 
&quot;trips&quot; : [ 	
{
&quot;#collection&quot; : &quot;Trips&quot;, 	
&quot;_id&quot; : ObjectId(&quot;55cf2bc73c9b0fe702000008&quot;) } ] }</code></pre><figcaption></figcaption></figure>

<p>
If your domain has strictly delimited areas, e.g. clients, you could think about creating one repository per area (client). 
</p>
<h3>Retrieving data </h3>

<p>
One question is if it possible to  retrieve data from Mongo collection even if the database was not created via Voyage.
Yes it is possible. Here is the solution.
</p>
<p>
First we create a class <code>MyClass</code> with two class side methods:
</p>
<figure><pre><code>MyClass class &gt;&gt; isVoyageRoot
	^ true</code></pre><figcaption></figcaption></figure>

<figure><pre><code>MyClass class &gt;&gt; descriptionContainer
    &lt;voyageContainer&gt;
    ^ VOContainer new
        collectionName: 'myCollection';
        yourself</code></pre><figcaption></figcaption></figure>
<p>
	
Also, to properly read the data one should add instance variables depending on what is in the database. 
</p>
<p>
For example if we have the following information stored in the database: 
</p>
<figure><pre><code>{ &quot;_id&quot; : ObjectId(&quot;5900a0175bc65a2b7973b48a&quot;), &quot;item&quot; : &quot;canvas&quot;, &quot;qty&quot; : 100, &quot;tags&quot; : [ &quot;cotton&quot; ] }</code></pre><figcaption></figcaption></figure>

<p>
In this case <code>MyClass</code> should have instanceVariables: <code>item</code>, <code>qty</code> and <code>tags</code> and accessors.
Then we define the following description on the class side
</p>
<figure><pre><code>MyClass class &gt;&gt; mongoItem
	&lt;mongoDescription&gt;
	^ VOToOneDescription new
		attributeName: 'item';
		kind: String;
		yourself</code></pre><figcaption></figcaption></figure>

<figure><pre><code>MyClass class &gt;&gt; mongoQty
	&lt;mongoDescription&gt;
	^ VOToOneDescription new
		attributeName: 'qty';
		kind: Integer;
		yourself</code></pre><figcaption></figcaption></figure>

<figure><pre><code>MyClass class &gt;&gt; mongoTags
	&lt;mongoDescription&gt;
	^ VOToOneDescription new
		attributeName: 'tags';
		kind: OrderedCollection;
		yourself</code></pre><figcaption></figcaption></figure>
<p>
	
After that one can connect to database and get the information.
</p>
<figure><pre><code>| repository | 
repository := VOMongoRepository database: 'databaseName'.
repository selectAll: MyClass</code></pre><figcaption></figcaption></figure>







  </section>

</article>

<footer>

<div class="footline">
    <div class="github-link">
      <a href="" target="blank"><i class="fa fa-code-fork"></i>Github</a>
    </div>
  </div>
</footer>

<script src="/booklet-Voyage/html/_support/html/js/clipboard.min.js"></script>

<link href="/booklet-Voyage/html/_support/html/css/featherlight.min.css" rel="stylesheet">
<script src="/booklet-Voyage/html/_support/html/js/featherlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="/booklet-Voyage/html/_support/html/js/flex.js"></script>
<!-- Prettify annotated paragraphs-->
    <script src="/booklet-Voyage/html_support/html/js/annotated-paragraphs.js"></script>

  </body>
</html>
