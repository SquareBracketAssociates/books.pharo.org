<!DOCTYPE html>
<html>
  <head>
    <title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="images/favicon.png" type="image/x-icon" />
<link href="/booklet-Smacc/html/_support/html/css/font-awesome.min.css" rel="stylesheet">
<link href="/booklet-Smacc/html/_support/html/css/nucleus.css" rel="stylesheet">
<link href="/booklet-Smacc/html/_support/html/css/flex.css" rel="stylesheet">
<link rel="stylesheet" href="/booklet-Smacc/html/_support/html/highlightjs/styles/default.css">
<link rel="stylesheet" href="/booklet-Smacc/html/_support/html/css/highlight-commands.css">
<link rel="stylesheet" href="/booklet-Smacc/html/_support/html/css/bootstrap.min.css">
<script src="/booklet-Smacc/html/_support/html/js/jquery-2.x.min.js"></script>
<script src="/booklet-Smacc/html/_support/html/highlightjs/highlight.pack.js"></script>
<script src="/booklet-Smacc/html/_support/html/js/highlight-commands.js"></script>
<meta name="description" content="">
<meta name="author" content="John Brant, Jason Lecerf,  Thierry Goubier, StÃ©phane Ducasse, and Andrew Black">
  </head>
  <body>
    <header>
  <div class="logo">
    <a class="baselink" href="/booklet-Smacc/html"></a>
  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
  
</header>
<article>
  <aside>
    <ul class="menu">
   		<li data-nav-id="123" class="dd-item">
    		<a href="/booklet-Smacc/html">
		       <i class="fa fa-fw fa-home"></i>
	    	</a>
        </li>

		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/booklet-Smacc/html/Chapters/Smacc/SmaccIntro.html#about this booklet">
					About this Booklet
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccIntro.html#contents">
							Contents
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccIntro.html#obtaining smacc">
							Obtaining SmaCC
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccIntro.html#basics">
							Basics
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTutorial.html#a first smacc tutorial">
					A First SmaCC Tutorial
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTutorial.html#opening the tools">
							Opening the Tools
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item  haschildren ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTutorial.html#first, the scanner">
							First, the Scanner
						</a>
						<i class="fa fa-angle-right fa-lg category-icon"></i>
					</div>

					<ul class="dd-item">
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTutorial.html#ignoring whitespace">Ignoring Whitespace</a>
						</li>
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTutorial.html#second, the calculator grammar">
							Second, the Calculator Grammar
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTutorial.html#compile the scanner and the parser">
							Compile the Scanner and the Parser
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTutorial.html#testing our parser">
							Testing our Parser
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTutorial.html#defining actions">
							Defining Actions
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTutorial.html#named expressions">
							Named Expressions
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTutorial.html#extending the language">
							Extending the Language
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTutorial.html#handling priority">
							Handling Priority
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTutorial.html#handling priority with directives">
							Handling Priority with Directives
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/booklet-Smacc/html/Chapters/Smacc/SmaccScanner.html#smacc scanner">
					SmaCC Scanner
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccScanner.html#regular expression syntax">
							Regular Expression Syntax
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccScanner.html#overlapping tokens">
							Overlapping Tokens
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccScanner.html#token action methods">
							Token Action Methods
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccScanner.html#unreferenced tokens">
							Unreferenced Tokens
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccScanner.html#unicode characters">
							Unicode Characters
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/booklet-Smacc/html/Chapters/Smacc/SmaccParser.html#smacc parser">
					SmaCC Parser
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccParser.html#production rules">
							Production Rules
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccParser.html#named symbols">
							Named Symbols
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccParser.html#error recovery">
							Error Recovery
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccParser.html#shortcuts">
							Shortcuts
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/booklet-Smacc/html/Chapters/Smacc/SmaccDirectives.html#smacc directives">
					SmaCC Directives
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccDirectives.html#start symbols">
							Start Symbols
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccDirectives.html#id methods">
							Id Methods
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccDirectives.html#case insensitive scanning">
							Case Insensitive Scanning
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccDirectives.html#ast directives">
							AST Directives
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item  haschildren ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccDirectives.html#dealing with ambiguous grammars">
							Dealing with Ambiguous Grammars
						</a>
						<i class="fa fa-angle-right fa-lg category-icon"></i>
					</div>

					<ul class="dd-item">
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccDirectives.html#lr, lalr and ambiguous grammars">LR, LALR and Ambiguous Grammars</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccDirectives.html#precedence rules">Precedence Rules</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccDirectives.html#glr parsing">GLR Parsing</a>
						</li>
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAST.html#smacc abstract syntax trees">
					SmaCC Abstract Syntax Trees
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAST.html#restarting">
							Restarting
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAST.html#building nodes ">
							Building Nodes 
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAST.html#variables and unnamed entities">
							Variables and Unnamed Entities
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAST.html#unnamed symbols">
							Unnamed Symbols
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAST.html#generating the ast">
							Generating the AST
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAST.html#ast comparison">
							AST Comparison
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAST.html#extending the visitor">
							Extending the Visitor
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAdvanced.html#advanced features of smacc">
					Advanced Features of SmaCC
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAdvanced.html#multi-state scanners">
							Multi-state Scanners
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item  haschildren ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAdvanced.html#indentation-sensitive parsing">
							Indentation-Sensitive Parsing
						</a>
						<i class="fa fa-angle-right fa-lg category-icon"></i>
					</div>

					<ul class="dd-item">
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAdvanced.html#using token actions to customize the scanner">Using Token Actions to Customize the Scanner</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAdvanced.html#using newlines to separate statements">Using Newlines to Separate Statements</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAdvanced.html#augmenting the state of the scanner">Augmenting the State of the Scanner</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAdvanced.html#unnamed tokens">Unnamed Tokens</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAdvanced.html#closing blocks">Closing Blocks</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAdvanced.html#continuation lines">Continuation Lines</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAdvanced.html#ignoring blank lines">Ignoring Blank Lines</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccAdvanced.html#the rest of the story">The Rest of the Story</a>
						</li>
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTransformations.html#smacc transformations">
					SmaCC Transformations
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTransformations.html#defining transformations ">
							Defining Transformations 
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTransformations.html#pattern matching expressions">
							Pattern matching Expressions
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTransformations.html#example">
							Example
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTransformations.html#parametrizing transformations">
							Parametrizing Transformations
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccTransformations.html#restrictions and limitations">
							Restrictions and Limitations
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/booklet-Smacc/html/Chapters/Smacc/SmaccIdioms.html#grammar idioms">
					Grammar Idioms
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccIdioms.html#managing lists">
							Managing Lists
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccIdioms.html#using shortcuts">
							Using Shortcuts
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccIdioms.html#expressing optional features">
							Expressing Optional Features
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item ">
			<div>
			  <a href="/booklet-Smacc/html/Chapters/Smacc/SmaccConclusion.html#conclusion">
					Conclusion
			  </a>
			  
			</div>
			  <ul class="dd-item">
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/booklet-Smacc/html/Chapters/Smacc/SmaccVocabulary.html#vocabulary">
					Vocabulary
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccVocabulary.html#reference example ">
							Reference Example 
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccVocabulary.html#metagrammar structure">
							Metagrammar structure
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item  haschildren ">
					<div>
						<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccVocabulary.html#elements ">
							Elements 
						</a>
						<i class="fa fa-angle-right fa-lg category-icon"></i>
					</div>

					<ul class="dd-item">
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccVocabulary.html#production rule">Production rule</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccVocabulary.html#tokens">Tokens</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccVocabulary.html#keywords">Keywords</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccVocabulary.html#non terminal">Non Terminal</a>
						</li>
							
						<li class="dd-item">
							<a href="/booklet-Smacc/html/Chapters/Smacc/SmaccVocabulary.html#variables">Variables</a>
						</li>
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
    </ul>
  </aside>

  <section class="page">
    
	<h1>Smacc: a Compiler-Compiler</h1>
		
	<h2>SmaCC Abstract Syntax Trees</h2>
<a id="AST"></a>
<p>
SmaCC can generate abstract syntax trees from an annotated grammar.
In addition to the node classes to represent the trees, SmaCC also generates a generic visitor for the tree classes.
This is handy and boost your productivity especially since you can decide to change the AST structure afterwards and get a new one in no time.
</p>
<h3>Restarting</h3>

<p>
To create an AST, you need to annotate your grammar.
Let's start with the grammar of our simple expression parser from the tutorial.
Since we want to build an AST, we've removed the code that evaluates the expression.
</p>
<figure><pre><code>&lt;number&gt; : [0-9]+ (\. [0-9]*) ? ;
&lt;whitespace&gt; : \s+;

%left &quot;+&quot; &quot;-&quot;;
%left &quot;*&quot; &quot;/&quot;;
%right &quot;^&quot;;

Expression 
	: Expression &quot;+&quot; Expression 
	| Expression &quot;-&quot; Expression
	| Expression &quot;*&quot; Expression
	| Expression &quot;/&quot; Expression
	| Expression &quot;^&quot; Expression
	| &quot;(&quot; Expression &quot;)&quot;
	| Number
	;
Number 
	: &lt;number&gt;
	;</code></pre><figcaption></figcaption></figure>


<h3>Building Nodes </h3>

<p>
Building an AST-building parser works similarly to the normal parser.
Instead of inserting Pharo code after each production rule inside braces, <code>{}</code>, we insert the class name inside of double braces, <code>{{}}</code>.
Also, instead of naming a variable for use in the Pharo code, we name a variable so that it will be included as an instance variable in the node class we are defining.
</p>
<p>
Let's start with annotating the grammar for the AST node classes that we wish to parse.
We need to tell SmaCC where the AST node should be created and the name of the node's class to create.
In our example, we'll start by creating three node classes: Expression, Binary, and Number.
</p>
<figure><pre><code>&lt;number&gt; : [0-9]+ (\. [0-9]*) ? ;
&lt;whitespace&gt; : \s+;

%left &quot;+&quot; &quot;-&quot;;
%left &quot;*&quot; &quot;/&quot;;
%right &quot;^&quot;;

Expression 
	: Expression &quot;+&quot; Expression {{Binary}}
	| Expression &quot;-&quot; Expression {{Binary}}
	| Expression &quot;*&quot; Expression {{Binary}}
	| Expression &quot;/&quot; Expression {{Binary}}
	| Expression &quot;^&quot; Expression {{Binary}}
	| &quot;(&quot; Expression &quot;)&quot; {{}}
	| Number
	;
Number 
	: &lt;number&gt; {{Number}}
	;</code></pre><figcaption></figcaption></figure>

<p>
If you compile this grammar, SmaCC will complain that we need to define a root node.
Since the root has not been defined, SmaCC compiles the grammar as if the <code>{{...}}</code> expressions where not there and generates the same parser as above. 
</p>
<ul>
<li>Notice that for the parenthesized expression, we are using <code>{{}}</code>. This is a shortcut for the name of our production symbol (here, <code>{{Expression}}</code>). </li>
<li>Notice that we didn't annotate the last production in the Expression definition. Since it only contains a single item, Number, SmaCC will pull up its value which in this case will be a Number AST node.</li>
</ul>


<h3>Variables and Unnamed Entities</h3>

<p>
Now, let's add variable names to our rules:
</p>
<figure><pre><code>&lt;number&gt; : [0-9]+ (\. [0-9]*) ? ;
&lt;whitespace&gt; : \s+;

%left &quot;+&quot; &quot;-&quot;;
%left &quot;*&quot; &quot;/&quot;;
%right &quot;^&quot;;
%annotate_tokens;

Expression 
	: Expression 'left' &quot;+&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;-&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;*&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;/&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;^&quot; 'operator' Expression 'right' {{Binary}}
	| &quot;(&quot; Expression &quot;)&quot; {{}}
	| Number
	;
Number 
	: &lt;number&gt; {{Number}}
	;</code></pre><figcaption></figcaption></figure>

<p>
The first thing to notice is that we added the <code>%annotate_tokens;</code> directive.
This directive tells SmaCC to automatically create an instance variable for every unnamed token and keyword in the grammar.
An unamed token is a <code>&lt;&gt;</code> not followed by a variable (defined with <code>'aVariable'</code>) and an unnamed keyword is delimited by double quotes as in <code>&quot;(&quot;</code>.
</p>
<p>
In our example above, we have:
</p><ul>
<li>one unnamed token, <code>&lt;number&gt;</code>, and </li>
<li>two unnamed keywords, <code>(</code> and <code>)</code>. </li>
</ul>

<p>
When SmaCC sees an unnamed token or keyword, it adds a variable that is named based on the item and appends Token to the name.
For example, in our example above, SmaCC will use:
</p><ul>
<li>leftParenToken for <code>(</code>, </li>
<li>rightParenToken for <code>)</code>, and </li>
<li><code>numberToken</code> for <code>&lt;number&gt;</code>. </li>
</ul>

<p>
The method <code>SmaCCGrammar class&gt;&gt;tokenNameMap</code> contains the mapping to convert the keyword characters into valid Pharo variable names.
You can modify this dictionary if you wish to change the default names.
</p>

<h3>Unnamed Symbols</h3>

<p>
Notice that we did not name Expression in the <code>(</code> Expression <code>)</code> production rule.
When you don't name a symbol in a production, SmaCC tries to figure out what you want to do.
In this case, SmaCC determines that the Expression symbol produces either a Binary or Number node.
Since both of these are subclasses of the Expression, SmaCC will pull up the value of Expression and add the parentheses to that node.
So, if you parse <code>(3 + 4)</code>, you'll get a Binary node instead of an Expression node.
</p>

<h3>Generating the AST</h3>

<p>
Now we are ready to generate our AST.
We need to add directives that tell SmaCC our root AST class node and the prefix and suffix of our classes.
</p>
<figure><pre><code>&lt;number&gt; : [0-9]+ (\. [0-9]*) ? ;
&lt;whitespace&gt; : \s+;

%left &quot;+&quot; &quot;-&quot;;
%left &quot;*&quot; &quot;/&quot;;
%right &quot;^&quot;;

%annotate_tokens;
%root Expression;
%prefix AST;
%suffix Node;

Expression 
	: Expression 'left' &quot;+&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;-&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;*&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;/&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;^&quot; 'operator' Expression 'right' {{Binary}}
	| &quot;(&quot; Expression &quot;)&quot; {{}}
	| Number
	;
Number 
	: &lt;number&gt; {{Number}}
	;</code></pre><figcaption></figcaption></figure>

<p>
When you compile this grammar, in addition to the normal parser and scanner classes, SmaCC will create <code>ASTExpressionNode</code>, <code>ASTBinaryNode</code>, and <code>ASTNumberNode</code> node classes and an <code>ASTExpressionNodeVisitor</code> class that implements the visitor pattern for the tree classes.
</p>
<p>
The <code>ASTExpressionNode</code> class will define two instance variables, <code>leftParenTokens</code> and <code>rightParenTokens</code>, that will hold the <code>(</code> and <code>)</code> tokens.
Notice that these variables hold a collection of tokens instead of a single parenthesis token.
SmaCC figured out that each expression node could contain multiple parentheses and made their variables hold a collection.
Also, it pluralized the <code>leftParentToken</code> variable name to <code>leftParenTokens</code>.
You can customize how it pluralizes names in the <code>SmaCCVariableDefinition</code> class (See <code>pluralNameBlock</code> and <code>pluralNames</code>).
</p>
<p>
The <code>ASTBinaryNode</code> will be a subclass of <code>ASTExpressionNode</code> and will define three variables: <code>left</code>, <code>operator</code>, and <code>right</code>. 
</p><ul>
<li>The <code>left</code> and <code>right</code> instance variables will hold other <code>ASTExpressionNodes</code> and </li>
<li>the <code>operator</code> instance variable will hold a token for the operator. </li>
</ul>

<p>
Finally, the <code>ASTNumberNode</code> will be a subclass of <code>ASTExpressionNode</code> and will define a single instance variable, <code>number</code>, that holds the token for the number.
</p>
<p>
Now, if we inspect the result of parsing <code>3 + 4</code>, we'll get an Inspector on an <code>ASTBinaryNode</code>.
</p>

<h3>AST Comparison</h3>

<p>
SmaCC also generates the comparison methods for each AST node.
Let's add function evaluation to our expression grammar to illustrate this point.
</p>
<figure><pre><code>&lt;number&gt; : [0-9]+ (\. [0-9]*) ? ;
&lt;name&gt; : [a-zA-Z]\w*;
&lt;whitespace&gt; : \s+;

%left &quot;+&quot; &quot;-&quot;;
%left &quot;*&quot; &quot;/&quot;;
%right &quot;^&quot;;
%annotate_tokens;
%root Expression;
%prefix AST;
%suffix Node;

Expression 
	: Expression 'left' &quot;+&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;-&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;*&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;/&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;^&quot; 'operator' Expression 'right' {{Binary}}
	| &quot;(&quot; Expression &quot;)&quot; {{}}
	| Number
	| Function
	;
Number 
	: &lt;number&gt; {{Number}}
	;
Function
	: &lt;name&gt; &quot;(&quot; 'leftParen' (Expression 'argument' (&quot;,&quot; Expression 'argument')* )? &quot;)&quot; 'rightParen' {{}}
	;</code></pre><figcaption></figcaption></figure>

<p>
Now, if we inspect <code>Add(3, 4)</code>, we will get something that looks like an <code>ASTFunctionNode</code>.
</p>
<p>
In addition to generating the node classes, SmaCC also generates the comparison methods for each AST node.
For example, we can compare two parse nodes: <code>(CalculatorParser parse: '3 + 4') = (CalculatorParser parse: '3+4')</code>.
This returns true as whitespace is ignored.
However, if we compare <code>(CalculatorParser parse: '(3 + 4)') = (CalculatorParser parse: '3+4')</code>, we get false, since the first expression has parentheses.
We can tell SmaCC to ignore these by adding the <code>%ignore_variables</code> directive.
</p>
<figure><pre><code>&lt;number&gt; : [0-9]+ (\. [0-9]*) ? ;
&lt;name&gt; : [a-zA-Z]\w*;
&lt;whitespace&gt; : \s+;

%left &quot;+&quot; &quot;-&quot;;
%left &quot;*&quot; &quot;/&quot;;
%right &quot;^&quot;;
%annotate_tokens;
%root Expression;
%prefix AST;
%suffix Node;
%ignore_variables leftParenToken rightParenToken;

Expression 
	: Expression 'left' &quot;+&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;-&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;*&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;/&quot; 'operator' Expression 'right' {{Binary}}
	| Expression 'left' &quot;^&quot; 'operator' Expression 'right' {{Binary}}
	| &quot;(&quot; Expression &quot;)&quot; {{}}
	| Number
	| Function
	;
Number 
	: &lt;number&gt; {{Number}}
	;
Function
	: &lt;name&gt; &quot;(&quot; 'leftParen' (Expression 'argument' (&quot;,&quot; Expression 'argument')* )? &quot;)&quot; 'rightParen' {{}}
	;</code></pre><figcaption></figcaption></figure>

<p>
Now, we get true when we compare <code>(CalculatorParser parse: '(3 + 4)') = (CalculatorParser parse: '3+4')</code>.
</p>

<h3>Extending the Visitor</h3>

<p>
Finally, let's subclass the generated visitor to create a visitor that evaluates the expressions.
Here's the code for Pharo:
</p>
<figure><pre><code>ASTExpressionNodeVisitor subclass: #ASTExpressionEvaluator
	instanceVariableNames: 'functions'
	classVariableNames: ''
	package: 'SmaCC-Tutorial'.</code></pre><figcaption></figcaption></figure>

<figure><pre><code>ASTExpressionEvaluator &gt;&gt; functions
	^functions
		ifNil: 
			[functions := (Dictionary new)
						at: ''Add'' put: [:a :b | a + b];
						yourself ]' classified: 'private'.</code></pre><figcaption></figcaption></figure>


<figure><pre><code>ASTExpressionEvaluator &gt;&gt; visitBinary: aBinary
	| left right operation |
	left := self acceptNode: aBinary left.
	right := self acceptNode: aBinary right.
	operation := aBinary operator value.
	operation = ''^'' ifTrue: [ ^left ** right ].
	^left perform: operation asSymbol with: right' classified: 'visiting'.</code></pre><figcaption></figcaption></figure>

<figure><pre><code>ASTExpressionEvaluator &gt;&gt; visitFunction: aFunction
	| function arguments |
	function := self functions at: aFunction nameToken value
				ifAbsent: 
					[self error: ''Function '' , 
						aFunction nameToken value , 
						'' is not defined'' ].
	arguments := aFunction arguments collect: [ :each | self acceptNode: each ].
	^function valueWithArguments: arguments asArray classified: 'visiting'.</code></pre><figcaption></figcaption></figure>

<figure><pre><code>ASTExpressionEvaluator &gt;&gt; visitNumber: aNumber
	^ aNumber numberToken value asNumber' classified: 'visiting'.</code></pre><figcaption></figcaption></figure>

<p>
Now we can evaluate <code>ASTExpressionEvaluator new accept: (CalculatorParser parse: 'Add(3,4) * 12 / 2 ^ (3 - 1) + 10')</code> and get 31.

</p>

  </section>

</article>

<footer>

<div class="footline">
    <div class="github-link">
      <a href="" target="blank"><i class="fa fa-code-fork"></i>Github</a>
    </div>
  </div>
</footer>

<script src="/booklet-Smacc/html/_support/html/js/clipboard.min.js"></script>

<link href="/booklet-Smacc/html/_support/html/css/featherlight.min.css" rel="stylesheet">
<script src="/booklet-Smacc/html/_support/html/js/featherlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="/booklet-Smacc/html/_support/html/js/flex.js"></script>
<!-- Prettify annotated paragraphs-->
    <script src="/booklet-Smacc/html_support/html/js/annotated-paragraphs.js"></script>

  </body>
</html>
